<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!DOCTYPE html>
    <html>
      <head>
        <style>
          .avatar-option {
            display: none;
          }
          .wrapperProfileForm {
            display: none;
          }
        </style>
      </head>
      <body>
        <%- include('./partials/navbar.ejs')%>
        <div class="wrapperMovie">
          <div class="wrapperContent">
            
              
              <div class="leftContent">
                <h3><strong>Profile</strong></h3>
                <div class="contentWrapper">
                <%if(isAuthenticated){%> 
                  <%if(!UserInfo){%>
                    <p>You don't have a profile yet</p>
                <button id="toggleProfileBtn">Create Profile</button>
                <%} if(UserInfo){%>
                <div class="userProfile">
                  <img src="/images/<%=UserInfo.Avatar%>.png"height="100px"width="100px"/>
                  <p><strong>Username: </strong><%= UserInfo.Nickname %></p>
                  <p><strong>Age: </strong><%= UserInfo.Age %></p>
                  <p><strong>Bio: </strong></p>
                  <p><%= UserInfo.Bio %></p>
                  
                </div>
              
                <button id="toggleProfileBtn">Update Profile</button><br>
                <button id="deleteProfile">Delete Profile</button>
                <% } %>
                <%} else{%>
                <h4>Sign in to manage your profile</h4>
                <form action="/login">
                  <input type="submit" value="Sign in" />
                </form>
                <%}%>
              </div>
            </div>
            <div class="wrapperProfileForm">
              <form id="profileForm" action="" method="POST">
                <% if(!UserInfo) { %>
                  <h3>Create profile</h3>
                    
                <%}else{%>
                  <h3>Update profile</h3>
                <%}%>
                
                <label for="nickname">Nickname:</label><br />
                <input
                  type="text"
                  id="nickname"
                  name="nickname"
                  required
                /><br /><br />

                <label for="age">Age:</label><br />
                <input type="number" id="age" name="age" required /><br /><br />

                <label for="bio">Bio:</label><br />
                <textarea
                  id="bio"
                  name="bio"
                  rows="4"
                  cols="50"
                  required
                ></textarea
                ><br /><br />

                <label for="avatar">Avatar:</label><br />
                <select id="avatar" name="avatar" required>
                  <option value="" selected disabled>Select Avatar</option>
                  <option value="batman">Batman</option>
                  <option value="bird">Bird</option>
                  <option value="frog">Frog</option>
                  <option value="hands">Hands</option>
                  <option value="heart">Heart</option>
                  <option value="light">Lightbulb</option>
                  <option value="star">Star</option>
                  <option value="yoda">Yoda</option></select
                ><br /><br />

                <input type="submit" onclick="refresh()" value="Submit" />
              </form>
              <script>
                const form = document.getElementById('profileForm');
                const toggleProfileBtn =
                  document.getElementById('toggleProfileBtn');
                const wrapperProfile =
                  document.querySelector('.wrapperProfileForm');
                const body = document.body;

                toggleProfileBtn.addEventListener('click', function () {
                  const currentDisplay =
                    getComputedStyle(wrapperProfile).display;
                  wrapperProfile.style.display =
                    currentDisplay === 'none' ? 'block' : 'none';
                  body.classList.toggle('modal-open');
                });

                form.addEventListener('submit', function (event) {
                    event.preventDefault();  

                  const formData = new FormData(form);

                  fetch('/profile', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                      FormData: Object.fromEntries(formData),
                    }),
                  })
                    .then((response) => {
                      console.log('Form submitted successfully');
                      // Reset the form fields if needed
                      form.reset();
                      // Hide the profile form after submitting
                      wrapperProfile.style.display = 'none';
                      body.classList.remove('modal-open');
                    })
                    .catch((error) => {
                      console.error('Error submitting form:', error);
                    });
                });

                const avatarSelect = document.getElementById('avatar');
                avatarSelect.addEventListener('change', function (event) {
                  const selectedAvatar = avatarSelect.value;
                  const avatarOptions =
                    document.getElementsByClassName('avatar-option');

                  for (let i = 0; i < avatarOptions.length; i++) {
                    avatarOptions[i].style.display = 'none';
                  }

                  if (selectedAvatar) {
                    const selectedOption = document.getElementById(
                      `avatar-option-${selectedAvatar}`
                    );
                    selectedOption.style.display = 'block';
                  }
                });

                function refresh(){
                  setTimeout(() => {
                    location.reload();
                  }, 50);
                }
              </script>
            </div><!--WRapper ProfileForm-->
        </div><!--WRapper Content-->
            <%- include('./partials/footer.ejs')%>
          </div> <!--WRapper movie-->
    
      </body>
    </html>
  </head>
</html>
